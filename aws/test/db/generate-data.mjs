/* eslint-disable no-await-in-loop */
// ignore unused exports default

/*
TRANSACTION
[
  {
    _id: '0x0776358c55a341c7cfe04413dabb2d8a47b776bf8c8265416b34116eb88c3e9e',
    transactionHash: '0x0776358c55a341c7cfe04413dabb2d8a47b776bf8c8265416b34116eb88c3e9e',
    blockNumber: 331,
    blockNumberL2: 0,
    circuitHash: '0x6161ab163f',
    commitments: [
      '0x050be97b689fb178b42a52c0226f0d9abd5be94271e99dc527e314c5a3060d89'
    ],
    compressedSecrets: [
      '0x0000000000000000000000000000000000000000000000000000000000000000',
      '0x0000000000000000000000000000000000000000000000000000000000000000'
    ],
    ercAddress: '0x0000000000000000000000004315287906f3fcf2345ad1bfe0f682457b041fa7',
    fee: '0x000000000000000000000000',
    historicRootBlockNumberL2: [],
    mempool: false,
    nullifiers: [],
    proof: [
      '426178678557561449159342685824996448097417322182987148669656695784108374874',
      '16331785558692519635837991080365378677984899482107588535630235068468903692705',
      '66743171364355010271349545822957392067700404864769621948719210246063446285612',
      '21766481049631627660531383820437270575576846842534730691973130840233180588310'
    ],
    recipientAddress: '0x0000000000000000000000000000000000000000000000000000000000000000',
    tokenId: '0x0000000000000000000000000000000000000000000000000000000000000000',
    tokenType: '0x00',
    transactionHashL1: '0xd8499d887d2046cf5c2275799ad815f2e1938bab99729d9b5162c431a3798f8d',
    value: '0x000000000000000000000000000a',
    transactionHashLeafIndex: 0,
    transactionHashSiblingPath: [
      '0x0c24323e6c03eabe0d4b7d744c3d5f24e333624d2851a2e2f776dd0aa02226cd',
      '0xe7c2a8087ffde96d15d0aacabb26bd8268efdff003825ae649226ed1308dbc0b',
      '0x681e7b5bfc61b5dcad08fb081f3e2c50de068cd6bfdf5f112f62408c1a569094',
      '0x1210f01d43ad06fc5cc3cb126195dea7748fb85ebc5be3b80713f1510e464d5c',
      '0x18845db540a19f14045d08870fcafacd1cd70ee506076ec8a24d58d73b217d71',
      '0x885fe45b42bce46edd84313454f00766877cd690ab43f989a26b82888d77fce0'
    ],
    transactionHashesRoot: '0x0c24323e6c03eabe0d4b7d744c3d5f24e333624d2851a2e2f776dd0aa02226cd',
    timeBlockL2: null
  }
]

// BLOCK
[
  {
    _id: '0x1a4a54edc7e64c76e2ffb472f95265ff25aa7d0b4c5c2825b55cec12e0c36f53',
    blockHash: '0x1a4a54edc7e64c76e2ffb472f95265ff25aa7d0b4c5c2825b55cec12e0c36f53',
    blockNumber: 320,
    blockNumberL2: 0,
    frontierHash: '0x296bb60b6f848cee9b632e9abf5d93715902a2df842a33420fbc15cce95c1cec',
    leafCount: 32,
    nCommitments: 32,
    previousBlockHash: '0x0000000000000000000000000000000000000000000000000000000000000000',
    proposer: '0xfeeda3882dd44aeb394caeef941386e7ed88e0e0',
    root: '0x058538e546ad4dad86eeb30fd32df6575a26e72a82ca728bc24ff6f68d974190',
    timeBlockL2: ISODate("2023-02-21T22:42:43.000Z"),
    transactionHashL1: '0x46bc2a65088d39ad0412674e00e1f349d69e741e673adcc55c5087c754806b25',
    transactionHashes: [
      '0x00b640017fe043aa40ef09934ee7e5086ed783cb2ebd7730a1dc2145564e0e09',
      '0xeff0d2f8c4f0f1b9f335895d6a32b896f6374ba5ef86257ee5f3551d69c8d51a',
      '0xf156615a4ee5eea705274d71f23cdd8a481f940925ec318db25a6917c19e6d44',
      '0x809274d06c275bd306b3207b569c227eb431757156ac935100ad3df89a0bb368',
      '0x63934e0d42256dbc71deab6a264362ed62b7d8973aa71771d37241d7caf6f86f',
      '0x5f566ec64c59f96c4a4cd408d895a50200b908c5ed150187fce1eec08439599d',
      '0xa3f62db80a5861e237d10d125bbc57695e1f33c865f494b23e97c386ff30c382',
      '0x70aa2801b2369e357ba75b83b4832eb3147362179dfc0d74064721e9f1e6ac25',
      '0xeb3d4031db52cefc8203d5ba52ff2e5866fea6d567edcf1d05a7adc11de31352',
      '0x8546102424f766a61484f653331d5c2011c924a4306fe75a57c213b7e0083fc9',
      '0x069163f25eea729b61abc09a2a9ad5c948350a2f1ce701efff77f180006a9c01',
      '0x8605cadd9c2503df296af95f810fab9c01eeb58eccc9377a174df89459624b7d',
      '0xb478d25ba29fad737442b8faf4b3198d189d167e7e36d2653957da9c84033694',
      '0x66b7dcc5c5e5dc893895d4e3eb7723dc543bab3d07bf5441b4a4b3d909f4660a',
      '0x379888fe4430f599ae2f1238c386f4c16f4f2087297294acd0037285636c432b',
      '0x0ca0f2e1feb8e5a86e73009cf38559249a1d276bbb3a4200c5b4e3babed76109',
      '0x2de0d167a624cb5abf5392db2c0b18e8eb641eb8e5db568c3f913d807e7d62df',
      '0x46a5aa136e99901e6ead58546427a87bca2c2b18e52e6a00043849e9e0c2ca4d',
      '0x45fba2e30366ea4017df177bd8dce1cd9b62868fcaaa3c186626601c622348d8',
      '0xf9b0fc6e20e5f6bc549e6f2a3bb50e5f109419c3d44831fbd6da6236fa8b47a0',
      '0xb43fe57f56f7200d01fcc77a0c1d9b57bd40264121618210f2e0f0828ffecf00',
      '0xf11688280b8d84a3980d63e21aed4c1f7b5ad2653cade58d10aecc2e7f8904cd',
      '0x54929b6781a12884fb76f09002801f205017e17c5cf6cdf3e03e204f00b89b1a',
      '0x5f2b71df82375b7b80ebd6383a9dc7982f8a40b61c69e65a3e9b7517f18e006a',
      '0xdff281a537f2937f04224522cca7923725e9482530c917760aa57c1ffd14ce6f',
      '0x63ca641ccaf5f58605ede6c2cb28a5dc8e1f52530ec6f1a16adf25456407cd03',
      '0x42eab1e09306ca2c430e9f6f9ec1edff13dd0630d49df9ead7f82bc3b233a132',
      '0xb686cf976dd31d753b4cdda325088360aafceb1168bc2b1fa56f8538b920f1c4',
      '0xc006674bf9f597b81375f404ddb8785e9efa188e4d137bf7b267936b05d60774',
      '0xc0f9ed7e8dc230b4c55aeb1d8c36bc48c43e27465abbecd11f3a6c7fb4beccc8',
      '0x7ae8f04457a5f87f81094d4d60066a07f86ed78e81d899c35ea25663f433a6d0',
      '0xcaf8ba704c36bdf22174aeca3a08b07fa0c2a1f1d5a245e363c2163826f8e8ad'
    ],
    transactionHashesRoot: '0x881095d3f1acb4be6144577703188b17259b838c6dba536846f71a8de642aeaa'
  }
]



// TREE
[
  {
    _id: ObjectId("63f548f0bbb4271bbd06a31c"),
    blockNumber: 320,
    blockNumberL2: 0,
    frontier: [
      '0x28bfb16a2d0ef88bbdac8b58c12ed638e9c61b6337f0272428c4a8998f5e5f08',
      '0x021b747e38e5dc7dd2f720af1db432ff40660bc28259d15eea30f2ac615fc0eb',
      '0x01fdaba16ea7a6b888f1ca147d667529432aa5f04ea79cccba94e5af3c3a9b2c',
      '0x2ba6dcc659f9199810d02e9ac0e2efbc61e4937fd016d4b7ce1f4a36829759d2',
      '0x143a05b01337122381e09a52ecee2a487b2baaf9a6489e302217fe5f7ef8a02e',
      '0x0de6d5da47996bc55528d3d0d0c63dd3a64fbdb52cc19228b4087e8ca2ec0878'
    ],
    leafCount: 32,
    root: '0x058538e546ad4dad86eeb30fd32df6575a26e72a82ca728bc24ff6f68d974190'
  }
]

*/

import { saveBlock, saveTransaction, saveTree } from './database.mjs';

//const blocks = JSON.parse(fs.readFileSync('./data/blocks.json','utf-8'));
//const transactions = JSON.parse(fs.readFileSync('./data/transactions.json', 'utf-8'));
const COMPRESSED_SECRETS_LENGTH = 4;
const PROOF_LENGTH = 4;
const STARTING_L2_BLOCK = 0;

function randomHex(length) {
  var result = '0x0';
  const characters = 'ABCDEF0123456789';
  for (var i = 0; i < length; i++) {
    result += characters.charAt(Math.floor(Math.random() * characters.length));
  }
  return result;
}

function randomInt(max) {
  return Math.floor(Math.random() * max);
}

function generateTransactions(nTransactions) {
  const transactions = [];
  for (var i = 0; i < nTransactions; i++) {
    const transaction = {};
    const commitments = [];
    const nullifiers = [];
    const compressedSecrets = [];
    const proof = [];
    const rootL2 = [];
    const transactionHashSiblingPath = [];
    transaction.transactionHash = randomHex(63);
    transaction.blockNumber = randomInt(10000);
    transaction.blockNumberL2 = randomInt(10000);
    transaction.circuitHash = randomHex(10);
    transaction.transactionHashesRoot = randomHex(63);
    transaction.transactionHashLeafIndex = 0;
    for (var j1 = 0; j1 < 4; j1++) {
      commitments.push(randomHex(63));
      nullifiers.push(randomHex(63));
      rootL2.push(String(randomInt(100)));
    }

    for (j1 = 0; j1 < 30; j1++) {
      transactionHashSiblingPath.push(randomHex(63));
    }
    transaction.transactionHashSiblingPath = transactionHashSiblingPath;
    transaction.ercAddress = randomHex(63);
    transaction.fee = randomHex(24);
    transaction.mempool = randomInt(2) === 0 ? false : true;
    transaction.recipientAddress = randomHex(63);
    transaction.tokenId = randomHex(63);
    transaction.tokenType = randomHex(2);
    transaction.transactionHashL1 = randomHex(63);
    transaction.value = randomHex(28);

    transaction.commitments = commitments;
    transaction.nullifiers = nullifiers;
    transaction.historicRootBlockNumberL2 = rootL2;

    for (var j2 = 0; j2 < COMPRESSED_SECRETS_LENGTH; j2++) {
      compressedSecrets.push(randomHex(63));
    }
    transaction.compressedSecrets = compressedSecrets;

    for (var j3 = 0; j3 < PROOF_LENGTH; j3++) {
      proof.push(randomHex(63));
    }
    transaction.proof = proof;

    transactions.push(transaction);
  }
  return transactions;
}

function generateBlocks(transactions, transactionsPerBlock) {
  const blocks = [];
  for (var blockIdx = 0; blockIdx < transactions.length / transactionsPerBlock; blockIdx++) {
    const block = {};
    const transactionHashes = [];
    block.blockHash = randomHex(63);
    block.blockNumber = randomInt(1000);
    block.blockNumberL2 = blockIdx + Number(STARTING_L2_BLOCK);
    block.frontierHash = randomInt(63);
    block.leafCount = randomInt(100);
    block.nCommitments = 32;
    block.previousBlockHash = randomHex(63);
    block.root = randomHex(63);
    block.time = new Date().getDate();
    block.proposer = randomHex(63);
    block.transactionHashL1 = randomHex(63);
    for (var transactionIdx = 0; transactionIdx < transactionsPerBlock; transactionIdx++) {
      transactionHashes.push(
        transactions[transactionIdx + blockIdx * transactionsPerBlock].transactionHash,
      );
    }
    block.transactionHashes = transactionHashes;
    block.transactionHashesRoot = randomHex(63);
    blocks.push(block);
  }

  return blocks;
}

function generateTimber(blocks) {
  const timberArray = [];
  for (const block of blocks) {
    const timber = {};
    timber.frontier = [];
    for (var timberIdx = 0; timberIdx < 6; timberIdx++) {
      timber.frontier.push(randomHex(63));
    }
    timber.blockNumber = block.blockNumber;
    timber.blockNumberL2 = block.blockNumberL2;
    timber.leafCount = randomHex(63);
    timber.root = randomHex(63);
    timberArray.push(timber);
  }
  return timberArray;
}

async function generateData(nTransactions, transactionsPerBlock) {
  const transactions = generateTransactions(nTransactions);
  for (const tx of transactions){
    await saveTransaction(tx);
  }
  const blocks = generateBlocks(transactions, transactionsPerBlock);
  for (const block of blocks){
    await saveBlock(block);
  }
  const timber = generateTimber(blocks);

  for (const tree of timber){
    await saveTree(tree);
  }

  //await new Promise(resolve => setTimeout(resolve, 5000));
} 

export default generateData;
